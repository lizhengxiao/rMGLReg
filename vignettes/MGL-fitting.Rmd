---
title: "MGL-fitting"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{MGL-fitting}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
  library(rMGLReg)
  library(fitdistrplus)
  library(splines)
  data("danishmulti")
  dt <- data.table::data.table(danishmulti)
  dt[, year := as.numeric(substr(Date, start = 1, stop = 4))]
  dtnew <- dt[Building>0&Contents>0]
  y1 <- dtnew$Building
  y2 <- dtnew$Contents
  
  XY <- cbind(y1, y2)
  y <- cbind(y1, y2)
  m1 <- sROC::kCDF(y[,1], bw = 0.2, xgrid = sort(y[,1]))
  m2 <- sROC::kCDF(y[,2], bw = 0.2, xgrid = sort(y[,2]))
  x <- cbind(m1$x, m2$x)
  u1 <- m1$Fhat;y1 <- y[,1]
  u1[order(y1)] <- m1$Fhat
  u2 <- m2$Fhat; y2 <- y[,2]
  u2[order(y2)] <- m2$Fhat
  U <- cbind(u1, u2) # empirical cdf
  Usample <- U
```



```{r}
m.norm <- MGL.mle(U = U,
                        copula  = "Normal",
                        initpar = 0.5)

m.t <- MGL.mle(U = U,
                     copula  = "t",
                     initpar = c(0.5, 4))
m.gumbel <- MGL.mle(U = U,
                     copula  = "Gumbel",
                          initpar = c(2))
m.MGLMGA180 <- MGL.mle(U,
                    copula  = "MGL180",
                             initpar = c(1))
m.MGB2 <- MGL.mle(U,
                      copula  = "MGB2",
                        initpar = c(0.1, 2, 0.4))

m.MGLEV180 <- MGL.mle(U,
                         copula  = "MGL-EV180",
                         initpar = c(2))


```



```{r}
recap <- function(x){
  res <- c(alpha = x$estimates,
           se = x$se,
           loglike = x$loglike,
           AIC = x$AIC, BIC = x$BIC)
  if(length(res) < 6)
    res <- c(res[1], NA, NA,res[2], NA, NA, res[3:5])
  if (length(res) > 6 & length(res) < 9)
    res <- c(res[1:2], NA, res[3:4], NA, res[5:7])
  res <- as.matrix(res)
  colnames(res) <- x$copula$name
  res}
res.all <- round(cbind(recap(m.norm),
                       recap(m.t),
                       recap(m.gumbel),
                       recap(m.MGLMGA180),
                       recap(m.MGB2),
                       recap(m.MGLEV180)
), 4)
out.com <- t(res.all)
out.com <- out.com[order(out.com[,9], decreasing = T),]
knitr::kable(out.com, digits = 2)

```
